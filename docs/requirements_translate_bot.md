# 要件定義書: Discord翻訳ボット

## 1. 概要

Discordサーバー内の特定のチャンネルにおいて、日本語以外のメッセージが投稿された際に、それを検知し日本語に翻訳して投稿するボットを開発する。

## 2. 背景

多言語話者が存在するDiscordサーバーにおいて、コミュニケーションを円滑にするため、自動翻訳機能が求められている。しかし、すべてのチャンネルで翻訳が実行されると、ノイズが多くなる可能性があるため、特定のチャンネルに限定する必要がある。

## 3. 機能要件

### 3.1. メッセージ翻訳機能
- Discordボットは、指定されたチャンネルに投稿されたユーザーのメッセージを監視する。
- 投稿されたメッセージが日本語以外である場合、それを検知する。
- 検知したメッセージを日本語に翻訳する。
- 翻訳結果を、元のメッセージが投稿されたチャンネルにそのまま投稿する。
- 翻訳結果には、元の言語と翻訳である旨を明記する。

### 3.2. 言語判定機能
- 投稿されたメッセージがどの言語で書かれているかを自動的に判定する。
- 日本語と判定された場合は、翻訳処理を行わない。
- 言語判定の精度は90%以上を目標とする。

### 3.3. ボットUI翻訳機能
- ボットがユーザーに応答として送信するメッセージ（埋め込みメッセージ、ボタンラベル等を含む）内のテキストも、必要に応じて日本語に翻訳する。
- 翻訳対象とするUI要素：
  - コマンド応答メッセージ
  - エラーメッセージ
  - インタラクティブコンポーネント（ボタン、セレクトメニュー等）のラベル
  - ヘルプメッセージ

### 3.4. チャンネル指定機能
- ボットのメッセージ翻訳機能が動作するチャンネルを管理者が指定できる機能を持つ。
- 指定されていないチャンネルでは、翻訳機能は動作しない。
- チャンネル指定は以下の方法で行う：
  - サーバー管理者向けのコマンド（例: `/translate-config channel #チャンネル名`）を提供する。
  - 設定は永続的に保存され、ボットの再起動後も維持される。

### 3.5. コマンド機能
- 以下のスラッシュコマンドを実装する：
  - `/translate-help` - ボットの使用方法を表示
  - `/translate-config channel` - 翻訳対象チャンネルを設定（管理者のみ）
  - `/translate-config list` - 現在の設定を表示

## 4. 非機能要件

### 4.1. 翻訳精度
- 一般的な会話において、意味が通じるレベルの翻訳精度を目指す。
- 専門用語や俗語に関しては、翻訳精度が低下する可能性があることを許容する。

### 4.2. パフォーマンス
- メッセージ投稿から翻訳結果の投稿までの時間を現実的な範囲（例: 3秒以内）に収める。
- Discord APIのレートリミットに抵触しないように実装する。
- 同時に処理できるメッセージ数は、チャンネルごとに毎分最大30件とする。

### 4.3. セキュリティ
- 翻訳APIキーなどの機密情報は環境変数として安全に管理する。
- ボット操作権限は適切に制限し、管理コマンドは管理者権限を持つユーザーのみが実行できるようにする。

### 4.4. ユーザビリティ
- チャンネル指定の方法は直感的で簡単であること。
- エラーメッセージは具体的で理解しやすいものにする。
- 初回導入時のセットアップガイドを提供する。

### 4.5. 可用性
- ボットの稼働率は月間99%以上を目標とする。
- 障害発生時には自動で再接続を試みる仕組みを実装する。

## 5. 制約事項

- 翻訳対象言語は、主要な言語（例: 英語、中国語、韓国語など）を優先するが、具体的な対応言語は別途検討する。
- 使用する翻訳APIは、別途選定・決定する（候補: Google Cloud Translation API, DeepL API）。
- ボットの実装言語は、Node.js（Discord.js）とする。
- 画像内のテキストは翻訳対象外とする。

## 6. 実装スケジュール

### フェーズ1: 基本機能実装（優先度高）
- Discord.jsを用いたボットの基本構造の実装
- 特定チャンネルでのメッセージ監視機能
- 言語判定機能
- テキストメッセージの翻訳機能
- チャンネル指定機能（基本実装）

### フェーズ2: 拡張機能実装（優先度中）
- スラッシュコマンドの実装
- 設定の永続化
- ボットUI翻訳機能

### フェーズ3: 品質向上と拡張（優先度低）
- パフォーマンス最適化
- エラーハンドリングの強化
- 将来的な拡張機能の実装

## 7. テストと展開

### テスト計画
- 単体テスト: 各機能モジュールの動作検証
- 統合テスト: 複数機能の連携動作検証
- 負荷テスト: 高頻度メッセージ時の挙動確認

### 展開計画
- 開発環境でのテスト後、ステージング環境で検証
- 問題がなければ本番環境へ展開
- 展開後の監視体制を確立

## 8. 将来的な拡張性 (任意)

- 翻訳元言語/翻訳先言語をユーザーが選択できる機能。
- 特定のユーザーの発言のみを翻訳する機能。
- 翻訳のON/OFFをユーザーが切り替えられる機能。
- 翻訳精度向上のための学習機能。
- 特定の単語や表現のカスタム翻訳辞書機能。 