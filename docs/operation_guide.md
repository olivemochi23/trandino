# 運用ガイド

---
**補足:**
- ボタンや編集で内容が変わったメッセージも自動で翻訳されます。
- Bot/アプリ/他Botのメッセージも翻訳対象です（自分自身のメッセージは除外）。
- 翻訳結果は「翻訳文のみ」表示されます。
---

## 目次
- [前提条件](#前提条件)
- [起動 / 停止手順](#起動--停止手順)
- [ログ管理](#ログ管理)
- [障害対応](#障害対応)
- [バックアップとリカバリ](#バックアップとリカバリ)
- [環境変数の管理](#環境変数の管理)

## 前提条件
- Node.js >= 20
- 必要な環境変数を設定した `.env` ファイルをプロジェクトルートに配置

## 起動 / 停止手順
1. 依存パッケージのインストール
   ```bash
   npm ci
   ```
2. スラッシュコマンド登録（初回または変更時）
   ```bash
   npm run deploy-commands
   ```
3. ボットの起動
   - 本番モード:
     ```bash
     npm start
     ```
   - 開発モード (自動再起動):
     ```bash
     npm run dev
     ```
4. 停止
   - 実行中のターミナルで `Ctrl+C` を押下して終了

## ログ管理
- ログファイル保存先: `logs/` ディレクトリ内
- ログレベル設定: 環境変数 `LOG_LEVEL` に `info` / `debug` / `error` 等を指定
- ログローテーション:
  - 日次、またはサイズ(例: 100MB)超過時に古いログを削除するスクリプトを Cron 等で実行推奨
  - 例:
    ```bash
    find logs/ -type f -name "*.log" -size +100M -delete
    ```

## 障害対応
1. **ボットが起動しない**
   - `.env` の各種キー (DISCORD_TOKEN / GOOGLE_API_KEY 等) 設定を再確認
   - `npm run lint` / `npm test` でエラー内容を確認し修正
2. **翻訳機能が動作しない**
   - Google API キーの有効性を [Google Cloud Console] で確認
   - キャッシュクリア: `data/translation-cache.json` を削除して再起動
3. **Discord 接続切断が頻発**
   - トークンの有効期限切れを確認
   - ネットワーク障害の有無をチェック

## バックアップとリカバリ
- `data/` 配下のキャッシュファイルを定期バックアップ
- GCP プロジェクトの設定は IAM 権限で厳密に管理

## 環境変数の管理
- `.env.example` を元に `.env` を生成
- シークレットは Git リポジトリに含めず、GitHub Secrets や Vault で安全管理 